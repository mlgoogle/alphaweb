/*! messenger 1.5.0 */
(function(){var a=window.Messenger;var b;b=window.Messenger=function(){return b._call.apply(this,arguments)};window.Messenger.noConflict=function(){window.Messenger=a;return b}})();window.Messenger._=(function(){if(window._){return window._}var j=Array.prototype,v=Object.prototype,x=Function.prototype;var i=j.push,p=j.slice,g=j.concat,r=v.toString,o=v.hasOwnProperty;var n=j.forEach,h=j.map,t=j.reduce,e=j.reduceRight,m=j.filter,a=j.every,s=j.some,q=j.indexOf,f=j.lastIndexOf,c=Array.isArray,u=Object.keys,k=x.bind;var w={};var b={};var d=w.each=w.forEach=function(D,C,B){if(D==null){return}if(n&&D.forEach===n){D.forEach(C,B)}else{if(D.length===+D.length){for(var A=0,y=D.length;A<y;A++){if(C.call(B,D[A],A,D)===b){return}}}else{for(var z in D){if(w.has(D,z)){if(C.call(B,D[z],z,D)===b){return}}}}}};w.result=function(y,A){if(y==null){return null}var z=y[A];return w.isFunction(z)?z.call(y):z};w.once=function(A){var y=false,z;return function(){if(y){return z}y=true;z=A.apply(this,arguments);A=null;return z}};var l=0;w.uniqueId=function(y){var z=++l+"";return y?y+z:z};w.filter=w.select=function(B,A,z){var y=[];if(B==null){return y}if(m&&B.filter===m){return B.filter(A,z)}d(B,function(E,C,D){if(A.call(z,E,C,D)){y[y.length]=E}});return y};d(["Arguments","Function","String","Number","Date","RegExp"],function(y){w["is"+y]=function(z){return r.call(z)=="[object "+y+"]"}});w.defaults=function(y){d(p.call(arguments,1),function(z){if(z){for(var A in z){if(y[A]==null){y[A]=z[A]}}}});return y};w.extend=function(y){d(p.call(arguments,1),function(z){if(z){for(var A in z){y[A]=z[A]}}});return y};w.keys=u||function(A){if(A!==Object(A)){throw new TypeError("Invalid object")}var z=[];for(var y in A){if(w.has(A,y)){z[z.length]=y}}return z};w.bind=function(A,z){if(A.bind===k&&k){return k.apply(A,p.call(arguments,1))}var y=p.call(arguments,2);return function(){return A.apply(z,y.concat(p.call(arguments)))}};w.isObject=function(y){return y===Object(y)};return w})();window.Messenger.Events=(function(){if(window.Backbone&&Backbone.Events){return Backbone.Events}var a=function(){var c=/\s+/;var e=function(o,m,g,k){if(!g){return true}if(typeof g==="object"){for(var j in g){o[m].apply(o,[j,g[j]].concat(k))}}else{if(c.test(g)){var n=g.split(c);for(var h=0,f=n.length;h<f;h++){o[m].apply(o,[n[h]].concat(k))}}else{return true}}};var d=function(j,g){var k,h=-1,f=j.length;switch(g.length){case 0:while(++h<f){(k=j[h]).callback.call(k.ctx)}return;case 1:while(++h<f){(k=j[h]).callback.call(k.ctx,g[0])}return;case 2:while(++h<f){(k=j[h]).callback.call(k.ctx,g[0],g[1])}return;case 3:while(++h<f){(k=j[h]).callback.call(k.ctx,g[0],g[1],g[2])}return;default:while(++h<f){(k=j[h]).callback.apply(k.ctx,g)}}};var b={on:function(f,i,g){if(!(e(this,"on",f,[i,g])&&i)){return this}this._events||(this._events={});var h=this._events[f]||(this._events[f]=[]);h.push({callback:i,context:g,ctx:g||this});return this},once:function(g,j,h){if(!(e(this,"once",g,[j,h])&&j)){return this}var f=this;var i=_.once(function(){f.off(g,i);j.apply(this,arguments)});i._callback=j;this.on(g,i,h);return this},off:function(f,s,g){var p,r,t,q,o,h,n,m;if(!this._events||!e(this,"off",f,[s,g])){return this}if(!f&&!s&&!g){this._events={};return this}q=f?[f]:_.keys(this._events);for(o=0,h=q.length;o<h;o++){f=q[o];if(p=this._events[f]){t=[];if(s||g){for(n=0,m=p.length;n<m;n++){r=p[n];if((s&&s!==r.callback&&s!==r.callback._callback)||(g&&g!==r.context)){t.push(r)}}}this._events[f]=t}}return this},trigger:function(h){if(!this._events){return this}var g=Array.prototype.slice.call(arguments,1);if(!e(this,"trigger",h,g)){return this}var i=this._events[h];var f=this._events.all;if(i){d(i,g)}if(f){d(f,arguments)}return this},listenTo:function(h,f,j){var g=this._listeners||(this._listeners={});var i=h._listenerId||(h._listenerId=_.uniqueId("l"));g[i]=h;h.on(f,typeof f==="object"?this:j,this);return this},stopListening:function(h,f,j){var g=this._listeners;if(!g){return}if(h){h.off(f,typeof f==="object"?this:j,this);if(!f&&!j){delete g[h._listenerId]}}else{if(typeof f==="object"){j=this}for(var i in g){g[i].off(f,j,this)}this._listeners={}}return this}};b.bind=b.on;b.unbind=b.off;return b};return a()})();(function(){var e,l,f,n,j,m,h,k,d,c,a,i={}.hasOwnProperty,b=function(s,q){for(var p in q){if(i.call(q,p)){s[p]=q[p]}}function r(){this.constructor=s}r.prototype=q.prototype;s.prototype=new r();s.__super__=q.prototype;return s},g=[].slice,o=[].indexOf||function(r){for(var q=0,p=this.length;q<p;q++){if(q in this&&this[q]===r){return q}}return -1};e=jQuery;m=(d=window._)!=null?d:window.Messenger._;n=(c=typeof Backbone!=="undefined"&&Backbone!==null?Backbone.Events:void 0)!=null?c:window.Messenger.Events;f=(function(){function p(q){e.extend(this,n);if(m.isObject(q)){if(q.el){this.setElement(q.el)}this.model=q.model}this.initialize.apply(this,arguments)}p.prototype.setElement=function(q){this.$el=e(q);return this.el=this.$el[0]};p.prototype.delegateEvents=function(w){var t,s,v,u,x,q,r;if(!(w||(w=m.result(this,"events")))){return}this.undelegateEvents();t=/^(\S+)\s*(.*)$/;r=[];for(v in w){x=w[v];if(!m.isFunction(x)){x=this[w[v]]}if(!x){throw new Error('Method "'+w[v]+'" does not exist')}u=v.match(t);s=u[1];q=u[2];x=m.bind(x,this);s+=".delegateEvents"+this.cid;if(q===""){r.push(this.jqon(s,x))}else{r.push(this.jqon(s,q,x))}}return r};p.prototype.jqon=function(r,q,t){var s;if(this.$el.on!=null){return(s=this.$el).on.apply(s,arguments)}else{if(!(t!=null)){t=q;q=void 0}if(q!=null){return this.$el.delegate(q,r,t)}else{return this.$el.bind(r,t)}}};p.prototype.jqoff=function(q){var r;if(this.$el.off!=null){return(r=this.$el).off.apply(r,arguments)}else{this.$el.undelegate();return this.$el.unbind(q)}};p.prototype.undelegateEvents=function(){return this.jqoff(".delegateEvents"+this.cid)};p.prototype.remove=function(){this.undelegateEvents();return this.$el.remove()};return p})();h=(function(q){b(p,q);function p(){return p.__super__.constructor.apply(this,arguments)}p.prototype.defaults={hideAfter:10,scroll:true,closeButtonText:"&times;",escapeText:false};p.prototype.initialize=function(r){if(r==null){r={}}this.shown=false;this.rendered=false;this.messenger=r.messenger;return this.options=e.extend({},this.options,r,this.defaults)};p.prototype.show=function(){var r;if(!this.rendered){this.render()}this.$message.removeClass("messenger-hidden");r=this.shown;this.shown=true;if(!r){return this.trigger("show")}};p.prototype.hide=function(){var r;if(!this.rendered){return}this.$message.addClass("messenger-hidden");r=this.shown;this.shown=false;if(r){return this.trigger("hide")}};p.prototype.cancel=function(){return this.hide()};p.prototype.update=function(r){var t,s=this;if(m.isString(r)){r={message:r}}e.extend(this.options,r);this.lastUpdate=new Date();this.rendered=false;this.events=(t=this.options.events)!=null?t:{};this.render();this.actionsToEvents();this.delegateEvents();this.checkClickable();if(this.options.hideAfter){this.$message.addClass("messenger-will-hide-after");if(this._hideTimeout!=null){clearTimeout(this._hideTimeout)}this._hideTimeout=setTimeout(function(){return s.hide()},this.options.hideAfter*1000)}else{this.$message.removeClass("messenger-will-hide-after")}if(this.options.hideOnNavigate){this.$message.addClass("messenger-will-hide-on-navigate");if((typeof Backbone!=="undefined"&&Backbone!==null?Backbone.history:void 0)!=null){Backbone.history.on("route",function(){return s.hide()})}}else{this.$message.removeClass("messenger-will-hide-on-navigate")}return this.trigger("update",this)};p.prototype.scrollTo=function(){if(!this.options.scroll){return}return e.scrollTo(this.$el,{duration:400,offset:{left:0,top:-20}})};p.prototype.timeSinceUpdate=function(){if(this.lastUpdate){return(new Date)-this.lastUpdate}else{return null}};p.prototype.actionsToEvents=function(){var s,t,v,r,u=this;v=this.options.actions;r=[];for(t in v){s=v[t];r.push(this.events['click [data-action="'+t+'"] a']=(function(w){return function(x){x.preventDefault();x.stopPropagation();u.trigger("action:"+t,w,x);return w.action.call(u,x,u)}})(s))}return r};p.prototype.checkClickable=function(){var s,t,u,r;u=this.events;r=[];for(t in u){s=u[t];if(t==="click"){r.push(this.$message.addClass("messenger-clickable"))}else{r.push(void 0)}}return r};p.prototype.undelegateEvents=function(){var r;p.__super__.undelegateEvents.apply(this,arguments);return(r=this.$message)!=null?r.removeClass("messenger-clickable"):void 0};p.prototype.parseActions=function(){var r,v,s,t,w,u;v=[];w=this.options.actions;for(t in w){r=w[t];s=e.extend({},r);s.name=t;if((u=s.label)==null){s.label=t}v.push(s)}return v};p.prototype.template=function(r){var C,B,w,y,v,A,t,u,z,s,x=this;v=e("<div class='messenger-message message alert "+r.type+" message-"+r.type+" alert-"+r.type+"'>");if(r.showCloseButton){w=e('<button type="button" class="messenger-close" data-dismiss="alert">');w.html(r.closeButtonText);w.click(function(){var D;x.cancel();if(typeof(D=x.options).onClickClose==="function"){D.onClickClose()}return true});v.append(w)}if(r.escapeText){A=e('<div class="messenger-message-inner"></div>').text(r.message)}else{A=e('<div class="messenger-message-inner">'+r.message+"</div>")}v.append(A);if(r.actions.length){B=e('<div class="messenger-actions">')}s=r.actions;for(u=0,z=s.length;u<z;u++){t=s[u];C=e("<span>");C.attr("data-action",""+t.name);y=e("<a>");y.html(t.label);C.append(e('<span class="messenger-phrase">'));C.append(y);B.append(C)}v.append(B);return v};p.prototype.render=function(){var r;if(this.rendered){return}if(!this._hasSlot){this.setElement(this.messenger._reserveMessageSlot(this));this._hasSlot=true}r=e.extend({},this.options,{actions:this.parseActions()});this.$message=e(this.template(r));this.$el.html(this.$message);this.shown=true;this.rendered=true;return this.trigger("render")};return p})(f);j=(function(p){b(q,p);function q(){return q.__super__.constructor.apply(this,arguments)}q.prototype.initialize=function(){q.__super__.initialize.apply(this,arguments);return this._timers={}};q.prototype.cancel=function(){this.clearTimers();this.hide();if((this._actionInstance!=null)&&(this._actionInstance.abort!=null)){return this._actionInstance.abort()}};q.prototype.clearTimers=function(){var r,u,t,s;t=this._timers;for(r in t){u=t[r];clearTimeout(u)}this._timers={};return(s=this.$message)!=null?s.removeClass("messenger-retry-soon messenger-retry-later"):void 0};q.prototype.render=function(){var t,s,u,r;q.__super__.render.apply(this,arguments);this.clearTimers();u=this.options.actions;r=[];for(s in u){t=u[s];if(t.auto){r.push(this.startCountdown(s,t))}else{r.push(void 0)}}return r};q.prototype.renderPhrase=function(s,t){var r;r=s.phrase.replace("TIME",this.formatTime(t));return r};q.prototype.formatTime=function(s){var r;r=function(t,u){t=Math.floor(t);if(t!==1){u=u+"s"}return"in "+t+" "+u};if(Math.floor(s)===0){return"now..."}if(s<60){return r(s,"second")}s/=60;if(s<60){return r(s,"minute")}s/=60;return r(s,"hour")};q.prototype.startCountdown=function(s,v){var r,u,t,x,w=this;if(this._timers[s]!=null){return}r=this.$message.find("[data-action='"+s+"'] .messenger-phrase");u=(x=v.delay)!=null?x:3;if(u<=10){this.$message.removeClass("messenger-retry-later");this.$message.addClass("messenger-retry-soon")}else{this.$message.removeClass("messenger-retry-soon");this.$message.addClass("messenger-retry-later")}t=function(){var y;r.text(w.renderPhrase(v,u));if(u>0){y=Math.min(u,1);u-=y;return w._timers[s]=setTimeout(t,y*1000)}else{w.$message.removeClass("messenger-retry-soon messenger-retry-later");delete w._timers[s];return v.action()}};return t()};return q})(h);k=(function(p){b(q,p);function q(){return q.__super__.constructor.apply(this,arguments)}q.prototype.tagName="ul";q.prototype.className="messenger";q.prototype.messageDefaults={type:"info"};q.prototype.initialize=function(r){this.options=r!=null?r:{};this.history=[];return this.messageDefaults=e.extend({},this.messageDefaults,this.options.messageDefaults)};q.prototype.render=function(){return this.updateMessageSlotClasses()};q.prototype.findById=function(r){return m.filter(this.history,function(s){return s.msg.options.id===r})};q.prototype._reserveMessageSlot=function(t){var s,r,u=this;s=e("<li>");s.addClass("messenger-message-slot");this.$el.prepend(s);this.history.push({msg:t,$slot:s});this._enforceIdConstraint(t);t.on("update",function(){return u._enforceIdConstraint(t)});while(this.options.maxMessages&&this.history.length>this.options.maxMessages){r=this.history.shift();r.msg.remove();r.$slot.remove()}return s};q.prototype._enforceIdConstraint=function(u){var s,t,r,w,v;if(u.options.id==null){return}v=this.history;for(t=0,r=v.length;t<r;t++){s=v[t];w=s.msg;if((w.options.id!=null)&&w.options.id===u.options.id&&u!==w){if(u.options.singleton){u.hide();return}else{w.hide()}}}};q.prototype.newMessage=function(r){var u,w,t,s,v=this;if(r==null){r={}}r.messenger=this;h=(w=(t=Messenger.themes[(s=r.theme)!=null?s:this.options.theme])!=null?t.Message:void 0)!=null?w:j;u=new h(r);u.on("show",function(){if(r.scrollTo&&v.$el.css("position")!=="fixed"){return u.scrollTo()}});u.on("hide show render",this.updateMessageSlotClasses,this);return u};q.prototype.updateMessageSlotClasses=function(){var s,t,w,v,u,r,x;v=true;t=null;s=false;x=this.history;for(u=0,r=x.length;u<r;u++){w=x[u];w.$slot.removeClass("messenger-first messenger-last messenger-shown");if(w.msg.shown&&w.msg.rendered){w.$slot.addClass("messenger-shown");s=true;t=w;if(v){v=false;w.$slot.addClass("messenger-first")}}}if(t!=null){t.$slot.addClass("messenger-last")}return this.$el[""+(s?"remove":"add")+"Class"]("messenger-empty")};q.prototype.hideAll=function(){var u,t,s,v,r;v=this.history;r=[];for(t=0,s=v.length;t<s;t++){u=v[t];r.push(u.msg.hide())}return r};q.prototype.post=function(r){var s;if(m.isString(r)){r={message:r}}r=e.extend(true,{},this.messageDefaults,r);s=this.newMessage(r);s.update(r);return s};return q})(f);l=(function(q){b(p,q);function p(){return p.__super__.constructor.apply(this,arguments)}p.prototype.doDefaults={progressMessage:null,successMessage:null,errorMessage:"Error connecting to the server.",showSuccessWithoutError:true,retry:{auto:true,allow:true},action:e.ajax};p.prototype.hookBackboneAjax=function(t){var r,s=this;if(t==null){t={}}if(!(window.Backbone!=null)){throw"Expected Backbone to be defined"}t=m.defaults(t,{id:"BACKBONE_ACTION",errorMessage:false,successMessage:"Request completed successfully.",showSuccessWithoutError:false});r=function(v){var u;u=m.extend({},t,v.messenger);return s["do"](u,v)};if(Backbone.ajax!=null){if(Backbone.ajax._withoutMessenger){Backbone.ajax=Backbone.ajax._withoutMessenger}if(!(t.action!=null)||t.action===this.doDefaults.action){t.action=Backbone.ajax}r._withoutMessenger=Backbone.ajax;return Backbone.ajax=r}else{return Backbone.sync=m.wrap(Backbone.sync,function(){var u,w,v;v=arguments[0],u=2<=arguments.length?g.call(arguments,1):[];w=e.ajax;e.ajax=r;v.call.apply(v,[this].concat(g.call(u)));return e.ajax=w})}};p.prototype._getHandlerResponse=function(r){if(r===false){return false}if(r===true||!(r!=null)){return true}return r};p.prototype._parseEvents=function(t){var x,v,w,s,r,u,y;if(t==null){t={}}r={};for(s in t){w=t[s];v=s.indexOf(" ");u=s.substring(0,v);x=s.substring(v+1);if((y=r[u])==null){r[u]={}}r[u][x]=w}return r};p.prototype._normalizeResponse=function(){var v,t,x,s,w,u,r;x=1<=arguments.length?g.call(arguments,0):[];s=null;w=null;v=null;for(u=0,r=x.length;u<r;u++){t=x[u];if(t==="success"||t==="timeout"||t==="abort"){s=t}else{if(((t!=null?t.readyState:void 0)!=null)&&((t!=null?t.responseText:void 0)!=null)){w=t}else{if(m.isObject(t)){v=t}}}}return[s,v,w]};p.prototype.run=function(){var y,C,A,B,v,t,s,u,r,z,w,x=this;t=arguments[0],r=arguments[1],y=3<=arguments.length?g.call(arguments,2):[];if(r==null){r={}}t=e.extend(true,{},this.messageDefaults,this.doDefaults,t!=null?t:{});C=this._parseEvents(t.events);A=function(D,F){var E;E=t[D+"Message"];if(m.isFunction(E)){return E.call(x,D,F)}return E};s=(w=t.messageInstance)!=null?w:this.newMessage(t);if(t.id!=null){s.options.id=t.id}if(t.progressMessage!=null){s.update(e.extend({},t,{message:A("progress",null),type:"info"}))}v={};m.each(["error","success"],function(E){var D;D=r[E];return v[E]=function(){var M,R,O,Q,N,L,P,S,K,J,I,H,G,F,T;L=1<=arguments.length?g.call(arguments,0):[];K=x._normalizeResponse.apply(x,L),N=K[0],M=K[1],S=K[2];if(E==="success"&&!(s.errorCount!=null)&&t.showSuccessWithoutError===false){t.successMessage=null}if(E==="error"){if((J=t.errorCount)==null){t.errorCount=0}t.errorCount+=1}O=t.returnsPromise?L[0]:typeof D==="function"?D.apply(null,L):void 0;P=x._getHandlerResponse(O);if(m.isString(P)){P={message:P}}if(E==="error"&&((S!=null?S.status:void 0)===0||N==="abort")){s.hide();return}if(E==="error"&&((t.ignoredErrorCodes!=null)&&(I=S!=null?S.status:void 0,o.call(t.ignoredErrorCodes,I)>=0))){s.hide();return}R={message:A(E,S),type:E,events:(H=C[E])!=null?H:{},hideOnNavigate:E==="success"};Q=e.extend({},t,R,P);if(typeof((G=Q.retry)!=null?G.allow:void 0)==="number"){Q.retry.allow--}if(E==="error"&&(S!=null?S.status:void 0)>=500&&((F=Q.retry)!=null?F.allow:void 0)){if(Q.retry.delay==null){if(Q.errorCount<4){Q.retry.delay=10}else{Q.retry.delay=5*60}}if(Q.hideAfter){if((T=Q._hideAfter)==null){Q._hideAfter=Q.hideAfter}Q.hideAfter=Q._hideAfter+Q.retry.delay}Q._retryActions=true;Q.actions={retry:{label:"retry now",phrase:"Retrying TIME",auto:Q.retry.auto,delay:Q.retry.delay,action:function(){Q.messageInstance=s;return setTimeout(function(){return x["do"].apply(x,[Q,r].concat(g.call(y)))},0)}},cancel:{action:function(){return s.cancel()}}}}else{if(Q._retryActions){delete Q.actions.retry;delete Q.actions.cancel;delete t._retryActions}}s.update(Q);if(P&&Q.message){Messenger(m.extend({},x.options,{instance:x}));return s.show()}else{return s.hide()}}});if(!t.returnsPromise){for(z in v){B=v[z];u=r[z];r[z]=B}}s._actionInstance=t.action.apply(t,[r].concat(g.call(y)));if(t.returnsPromise){s._actionInstance.then(v.success,v.error)}return s};p.prototype["do"]=p.prototype.run;p.prototype.ajax=function(){var r,s;s=arguments[0],r=2<=arguments.length?g.call(arguments,1):[];s.action=e.ajax;return this.run.apply(this,[s].concat(g.call(r)))};p.prototype.expectPromise=function(s,r){r=m.extend({},r,{action:s,returnsPromise:true});return this.run(r)};p.prototype.error=function(r){if(r==null){r={}}if(typeof r==="string"){r={message:r}}r.type="error";return this.post(r)};p.prototype.info=function(r){if(r==null){r={}}if(typeof r==="string"){r={message:r}}r.type="info";return this.post(r)};p.prototype.success=function(r){if(r==null){r={}}if(typeof r==="string"){r={message:r}}r.type="success";return this.post(r)};return p})(k);e.fn.messenger=function(){var r,q,t,p,s,w,v,u;t=arguments[0],q=2<=arguments.length?g.call(arguments,1):[];if(t==null){t={}}r=this;if(!(t!=null)||!m.isString(t)){s=t;if(!(r.data("messenger")!=null)){k=(w=(v=Messenger.themes[s.theme])!=null?v.Messenger:void 0)!=null?w:l;r.data("messenger",p=new k(e.extend({el:r},s)));p.render()}return r.data("messenger")}else{return(u=r.data("messenger"))[t].apply(u,q)}};window.Messenger._call=function(p){var A,t,w,r,q,z,u,v,x,s,y;z={extraClasses:"messenger-fixed messenger-on-bottom messenger-on-right",theme:"future",maxMessages:9,parentLocations:["body"]};p=e.extend(z,e._messengerDefaults,Messenger.options,p);if(p.theme!=null){p.extraClasses+=" messenger-theme-"+p.theme}u=p.instance||Messenger.instance;if(p.instance==null){x=p.parentLocations;t=null;w=null;for(s=0,y=x.length;s<y;s++){v=x[s];t=e(v);if(t.length){r=v;break}}if(!u){A=e("<ul>");t.prepend(A);u=A.messenger(p);u._location=r;Messenger.instance=u}else{if(!e(u._location).is(e(r))){u.$el.detach();t.prepend(u.$el)}}}if(u._addedClasses!=null){u.$el.removeClass(u._addedClasses)}u.$el.addClass(q=""+u.className+" "+p.extraClasses);u._addedClasses=q;return u};e.extend(Messenger,{Message:j,Messenger:l,themes:(a=Messenger.themes)!=null?a:{}});e.globalMessenger=window.Messenger=Messenger}).call(this);
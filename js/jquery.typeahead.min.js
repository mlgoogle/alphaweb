/*!
 * jQuery Typeahead
 * Copyright (C) 2016 RunningCoder.org
 * Licensed under the MIT license
 *
 * @author Tom Bertrand
 * @version 2.4.0 (2016-3-26)
 * @link http://www.runningcoder.org/jquerytypeahead/
 */
;(function(a){if(typeof define==="function"&&define.amd){define("jquery-typeahead",["jquery"],function(b){return a(b)})}else{if(typeof module==="object"&&module.exports){module.exports=function(c,b){if(c===undefined){if(typeof window!=="undefined"){c=require("jquery")}else{c=require("jquery")(b)}}return a(c)}}else{a(jQuery)}}}(function(f){window.Typeahead={version:"2.4.0"};var a={input:null,minLength:2,maxItem:8,dynamic:false,delay:300,order:null,offset:false,hint:false,accent:false,highlight:true,group:false,groupOrder:null,maxItemPerGroup:null,dropdownFilter:false,dynamicFilter:null,backdrop:false,backdropOnFocus:false,cache:false,ttl:3600000,compression:false,suggestion:false,searchOnFocus:false,resultContainer:null,generateOnLoad:null,mustSelectItem:false,href:null,display:["display"],template:null,correlativeTemplate:false,emptyTemplate:false,filter:true,matcher:null,source:null,callback:{onInit:null,onReady:null,onShowLayout:null,onHideLayout:null,onSearch:null,onResult:null,onLayoutBuiltBefore:null,onLayoutBuiltAfter:null,onNavigateBefore:null,onNavigateAfter:null,onMouseEnter:null,onMouseLeave:null,onClickBefore:null,onClickAfter:null,onSendRequest:null,onReceiveRequest:null,onPopulateSource:null,onCacheSave:null,onSubmit:null},selector:{container:"typeahead-container",result:"typeahead-result",list:"typeahead-list",group:"typeahead-group",item:"typeahead-item",empty:"typeahead-empty",display:"typeahead-display",query:"typeahead-query",filter:"typeahead-filter",filterButton:"typeahead-filter-button",filterValue:"typeahead-filter-value",dropdown:"typeahead-dropdown",dropdownCaret:"typeahead-caret",button:"typeahead-button",backdrop:"typeahead-backdrop",hint:"typeahead-hint"},debug:false};var d=".typeahead";var c={from:"ãàáäâẽèéëêìíïîõòóöôùúüûñç",to:"aaaaaeeeeeiiiiooooouuuunc"};var b=~window.navigator.appVersion.indexOf("MSIE 9.");var h=function(j,i){this.rawQuery="";this.query=j.val()||"";this.tmpSource={};this.source={};this.isGenerated=null;this.generatedGroupCount=0;this.groupCount=0;this.groupBy="group";this.result={};this.resultHtml=null;this.resultCount=0;this.resultCountPerGroup={};this.options=i;this.node=j;this.container=null;this.resultContainer=null;this.item=null;this.xhr={};this.hintIndex=null;this.filters={dropdown:{},dynamic:{}};this.requests={};this.backdrop={};this.hint={};this.__construct()};h.prototype={extendOptions:function(){if(this.options.dynamic){this.options.cache=false;this.options.compression=false}if(this.options.cache){this.options.cache=(function(j){var k=["localStorage","sessionStorage"],i;if(j===true){j="localStorage"}else{if(typeof j==="string"&&!~k.indexOf(j)){if(this.options.debug){g.log({node:this.node.selector,"function":"extendOptions()",message:'Invalid options.cache, possible options are "localStorage" or "sessionStorage"'});g.print()}return false}}i=typeof window[j]!=="undefined";try{window[j].setItem("typeahead","typeahead");window[j].removeItem("typeahead")}catch(l){i=false}return i&&j||false}).call(this,this.options.cache)}if(this.options.compression){if(typeof LZString!=="object"||!this.options.cache){if(this.options.debug){g.log({node:this.node.selector,"function":"extendOptions()",message:"Missing LZString Library or options.cache, no compression will occur."});g.print()}this.options.compression=false}}if(typeof this.options.maxItem!=="undefined"&&(!/^\d+$/.test(this.options.maxItem)||this.options.maxItem===0)){this.options.maxItem=Infinity}if(this.options.maxItemPerGroup&&!/^\d+$/.test(this.options.maxItemPerGroup)){this.options.maxItemPerGroup=null}if(this.options.display&&!(this.options.display instanceof Array)){this.options.display=[this.options.display]}if(this.options.group&&!(this.options.group instanceof Array)){this.options.group=[this.options.group]}if(this.options.highlight&&!~["any",true].indexOf(this.options.highlight)){this.options.highlight=false}if(this.options.dynamicFilter&&!(this.options.dynamicFilter instanceof Array)){this.options.dynamicFilter=[this.options.dynamicFilter]}if(this.options.accent){if(typeof this.options.accent==="object"){if(this.options.accent.from&&this.options.accent.to&&this.options.accent.from.length===this.options.accent.to.length){}else{if(this.options.debug){g.log({node:this.node.selector,"function":"extendOptions()",message:'Invalid "options.accent", from and to must be defined and same length.'});g.print()}}}else{this.options.accent=c}}if(this.options.resultContainer){if(typeof this.options.resultContainer==="string"){this.options.resultContainer=f(this.options.resultContainer)}if(!(this.options.resultContainer instanceof jQuery)||!this.options.resultContainer[0]){if(this.options.debug){g.log({node:this.node.selector,"function":"extendOptions()",message:'Invalid jQuery selector or jQuery Object for "options.resultContainer".'});g.print()}}else{this.resultContainer=this.options.resultContainer}}if(this.options.group&&typeof this.options.group[0]==="string"&&this.options.maxItemPerGroup){this.groupBy=this.options.group[0]}if(this.options.callback&&this.options.callback.onClick){this.options.callback.onClickBefore=this.options.callback.onClick;delete this.options.callback.onClick}if(this.options.callback&&this.options.callback.onNavigate){this.options.callback.onNavigateBefore=this.options.callback.onNavigate;delete this.options.callback.onNavigate}this.options=f.extend(true,{},a,this.options)},unifySourceFormat:function(){if(this.options.source instanceof Array){this.options.source={group:{data:this.options.source}};this.groupCount+=1;return true}if(typeof this.options.source.data!=="undefined"||typeof this.options.source.url!=="undefined"){this.options.source={group:this.options.source}}var i;for(var j in this.options.source){if(!this.options.source.hasOwnProperty(j)){continue}i=this.options.source[j];if(typeof i==="string"||i instanceof Array){i={url:i}}if(!i.data&&!i.url){if(this.options.debug){g.log({node:this.node.selector,"function":"unifySourceFormat()","arguments":JSON.stringify(this.options.source),message:'Undefined "options.source.'+j+'.[data|url]" is Missing - Typeahead dropped'});g.print()}return false}if(i.display&&!(i.display instanceof Array)){i.display=[i.display]}if(i.ignore){if(!(i.ignore instanceof RegExp)){if(this.options.debug){g.log({node:this.node.selector,"function":"unifySourceFormat()","arguments":JSON.stringify(i.ignore),message:"Invalid ignore RegExp."});g.print()}delete i.ignore}}this.options.source[j]=i;this.groupCount+=1}return true},init:function(){this.helper.executeCallback.call(this,this.options.callback.onInit,[this.node]);this.container=this.node.closest("."+this.options.selector.container);if(this.options.debug){g.log({node:this.node.selector,"function":"init()",message:"OK - Typeahead activated on "+this.node.selector});g.print()}},delegateEvents:function(){var j=this,i=["focus"+d,"input"+d,"propertychange"+d,"keydown"+d,"keyup"+d,"dynamic"+d,"generateOnLoad"+d];this.container.off(d).on("click"+d+" touchstart"+d,function(l){if(j.options.dropdownFilter&&j.container.hasClass("filter")&&!f(l.target).closest("."+j.options.selector.dropdown.replace(" ","."))[0]){j.container.removeClass("filter")}});this.node.closest("form").on("submit",function(l){if(j.options.mustSelectItem&&j.helper.isEmpty(j.item)){l.preventDefault();return}if(!j.options.backdropOnFocus){j.hideLayout()}if(j.options.callback.onSubmit){return j.helper.executeCallback.call(j,j.options.callback.onSubmit,[j.node,this,j.item,l])}});var k=false;this.node.off(d).on(i.join(" "),function(l){switch(l.type){case"generateOnLoad":if(j.isGenerated===null){j.generateSource()}break;case"focus":if(j.options.backdropOnFocus){j.buildBackdropLayout();j.showLayout()}if(j.options.searchOnFocus&&j.query.length>=j.options.minLength){if(j.isGenerated){j.showLayout()}else{if(j.isGenerated===null){j.generateSource()}}}case"keydown":if(l.keyCode&&~[9,13,27,38,39,40].indexOf(l.keyCode)){k=true;j.navigate(l)}break;case"keyup":if(j.isGenerated===null&&!j.options.dynamic){j.generateSource()}if(b&&j.node[0].value.replace(/^\s+/,"").toString().length<j.query.length){j.node.trigger("input"+d)}break;case"propertychange":if(k){k=false;break}case"input":j.rawQuery=j.node[0].value.toString();j.query=j.rawQuery.replace(/^\s+/,"");if(j.options.hint&&j.hint.container&&j.hint.container.val()!==""){if(j.hint.container.val().indexOf(j.rawQuery)!==0){j.hint.container.val("")}}if(j.options.dynamic){j.isGenerated=null;j.helper.typeWatch(function(){if(j.query.length>=j.options.minLength){j.generateSource()}else{j.hideLayout()}},j.options.delay);return}case"dynamic":if(!j.isGenerated){break}j.searchResult();j.buildLayout();if((j.result.length>0||j.options.emptyTemplate)&&j.query.length>=j.options.minLength){j.showLayout()}else{j.hideLayout()}break}});if(this.options.generateOnLoad){this.node.trigger("generateOnLoad"+d)}},generateSource:function(){if(this.isGenerated&&!this.options.dynamic){return}this.generatedGroupCount=0;this.isGenerated=false;if(!this.helper.isEmpty(this.xhr)){for(var n in this.xhr){if(!this.xhr.hasOwnProperty(n)){continue}this.xhr[n].abort()}this.xhr={}}var o,k,j,l;for(o in this.options.source){if(!this.options.source.hasOwnProperty(o)){continue}k=this.options.source[o];if(this.options.cache){j=window[this.options.cache].getItem("TYPEAHEAD_"+this.node.selector+":"+o);if(j){if(this.options.compression){j=LZString.decompressFromUTF16(j)}l=false;try{j=JSON.parse(j+"");if(j.data&&j.ttl>new Date().getTime()){this.populateSource(j.data,o);l=true;if(this.options.debug){g.log({node:this.node.selector,"function":"generateSource()",message:'Source for group "'+o+'" found in '+this.options.cache});g.print()}}else{window[this.options.cache].removeItem("TYPEAHEAD_"+this.node.selector+":"+o)}}catch(m){}if(l){continue}}}if(k.data&&!k.url){this.populateSource(typeof k.data==="function"&&k.data()||k.data,o);continue}if(k.url){if(!this.requests[o]){this.requests[o]=this.generateRequestObject(o)}}}this.handleRequests()},generateRequestObject:function(n){var m=this,j=this.options.source[n];if(!(j.url instanceof Array)){j.url=[j.url]}var l={request:{url:null,dataType:"json",beforeSend:function(q,o){m.xhr[n]=q;var p=m.requests[n].extra.beforeSend||j.url[0].beforeSend;typeof p==="function"&&p.apply(null,arguments)}},extra:{path:null,group:n,callback:{done:null,fail:null,complete:null,always:null}},validForGroup:[n]};Object.defineProperty(l.request,"beforeSend",{writable:false});if(j.url[0] instanceof Object){if(j.url[0].callback){l.extra.callback=j.url[0].callback;delete j.url[0].callback}l.request=f.extend(true,l.request,j.url[0])}else{if(typeof j.url[0]==="string"){l.request.url=j.url[0]}}if(j.url[1]&&typeof j.url[1]==="string"){l.extra.path=j.url[1]}if(l.request.dataType.toLowerCase()==="jsonp"){l.request.jsonpCallback="callback_"+n}var i;for(var k in this.requests){if(!this.requests.hasOwnProperty(k)){continue}i=JSON.stringify(this.requests[k].request);if(i===JSON.stringify(l.request)){this.requests[k].validForGroup.push(n);l.isDuplicated=true;delete l.validForGroup;break}}return l},handleRequests:function(){var i=this,k=Object.keys(this.requests).length;if(this.helper.executeCallback.call(this,this.options.callback.onSendRequest,[this.node,this.query])===false){this.isGenerated=null;return}for(var j in this.requests){if(!this.requests.hasOwnProperty(j)){continue}if(this.requests[j].isDuplicated){continue}(function(q,n){if(typeof i.options.source[q].url[0]==="function"){var p=i.options.source[q].url[0].call(i,i.query);n.request=f.extend(true,n.request,p);if(typeof n.request!=="object"||!n.request.url){if(i.options.debug){g.log({node:i.node.selector,"function":"handleRequests",message:'Source function must return an object containing ".url" key for group "'+q+'"'});g.print()}return}if(p.beforeSend){i.requests[q].extra.beforeSend=p.beforeSend}}var l,o=false;if(~n.request.url.indexOf("{{query}}")){if(!o){n=f.extend(true,{},n);o=true}n.request.url=n.request.url.replace("{{query}}",i.query.sanitize())}if(n.request.data){for(var m in n.request.data){if(!n.request.data.hasOwnProperty(m)){continue}if(~String(n.request.data[m]).indexOf("{{query}}")){if(!o){n=f.extend(true,{},n);o=true}n.request.data[m]=n.request.data[m].replace("{{query}}",i.query.sanitize());break}}}f.ajax(n.request).done(function(u,v,t){var s;for(var r=0;r<n.validForGroup.length;r++){l=i.requests[n.validForGroup[r]];if(l.extra.callback.done instanceof Function){s=l.extra.callback.done(u,v,t);u=s instanceof Array&&s||u;if(!(s instanceof Array)){if(i.options.debug){g.log({node:i.node.selector,"function":"Ajax.callback.done()",message:"Invalid returned data has to be an Array"});g.print()}}}i.populateSource(u,l.extra.group,l.extra.path);k-=1;if(k===0){i.helper.executeCallback.call(i,i.options.callback.onReceiveRequest,[i.node,i.query])}}}).fail(function(s,u,t){for(var r=0;r<n.validForGroup.length;r++){l=i.requests[n.validForGroup[r]];l.extra.callback.fail instanceof Function&&l.extra.callback.fail(s,u,t)}if(i.options.debug){g.log({node:i.node.selector,"function":"Ajax.callback.fail()",message:"Request failed"});g.print()}}).then(function(s,t){for(var r=0;r<n.validForGroup.length;r++){l=i.requests[n.validForGroup[r]];l.extra.callback.then instanceof Function&&l.extra.callback.then(s,t)}}).always(function(t,u,s){for(var r=0;r<n.validForGroup.length;r++){l=i.requests[n.validForGroup[r]];l.extra.callback.always instanceof Function&&l.extra.callback.always(t,u,s)}})}(j,this.requests[j]))}},populateSource:function(m,r,u){var t=this,s=this.options.source[r],j=s.url&&s.data;m=typeof u==="string"?this.helper.namespace(u,m):m;if(typeof m==="undefined"){if(this.options.debug){g.log({node:this.node.selector,"function":"populateSource()","arguments":u,message:"Invalid data path."});g.print()}}if(!(m instanceof Array)){if(this.options.debug){g.log({node:this.node.selector,"function":"populateSource()","arguments":JSON.stringify({group:r}),message:"Invalid data type, must be Array type."});g.print()}m=[]}if(j){if(typeof j==="function"){j=j()}if(j instanceof Array){m=m.concat(j)}else{if(this.options.debug){g.log({node:this.node.selector,"function":"populateSource()","arguments":JSON.stringify(j),message:"WARNING - this.options.source."+r+".data Must be an Array or a function that returns an Array."});g.print()}}}var k,p=s.display?(s.display[0]==="compiled"?s.display[1]:s.display[0]):(this.options.display[0]==="compiled"?this.options.display[1]:this.options.display[0]);for(var l=0;l<m.length;l++){if(typeof m[l]==="string"){k={};k[p]=m[l];m[l]=k}m[l].group=r}if(this.options.correlativeTemplate){var q=s.template||this.options.template,o="";if(typeof q==="function"){q=q()}if(!q){if(this.options.debug){g.log({node:this.node.selector,"function":"populateSource()","arguments":JSON.stringify(r),message:"WARNING - this.options.correlativeTemplate is enabled but no template was found."});g.print()}}else{if(this.options.correlativeTemplate instanceof Array){for(var l=0;l<this.options.correlativeTemplate.length;l++){o+="{{"+this.options.correlativeTemplate[l]+"}} "}}else{o=q.replace(/<.+?>/g,"")}for(var l=0;l<m.length;l++){m[l]["compiled"]=o.replace(/\{\{([\w\-\.]+)(?:\|(\w+))?}}/g,function(v,i){return t.helper.namespace(i,m[l],"get","")}).trim()}if(s.display){if(!~s.display.indexOf("compiled")){s.display.unshift("compiled")}}else{if(!~this.options.display.indexOf("compiled")){this.options.display.unshift("compiled")}}}}if(this.options.callback.onPopulateSource){m=this.helper.executeCallback.call(this,this.options.callback.onPopulateSource,[this.node,m,r,u]);if(!m||!(m instanceof Array)){g.log({node:this.node.selector,"function":"callback.populateSource()",message:'callback.onPopulateSource must return the "data" parameter'});g.print()}}this.tmpSource[r]=m;if(this.options.cache&&!window[this.options.cache].getItem("TYPEAHEAD_"+this.node.selector+":"+r)){if(this.options.callback.onCacheSave){m=this.helper.executeCallback.call(this,this.options.callback.onCacheSave,[this.node,m,r,u]);if(!m||!(m instanceof Array)){g.log({node:this.node.selector,"function":"callback.populateSource()",message:'callback.onCacheSave must return the "data" parameter'});g.print()}}var n=JSON.stringify({data:m,ttl:new Date().getTime()+this.options.ttl});if(this.options.compression){n=LZString.compressToUTF16(n)}window[this.options.cache].setItem("TYPEAHEAD_"+this.node.selector+":"+r,n)}this.incrementGeneratedGroup()},incrementGeneratedGroup:function(){this.generatedGroupCount+=1;if(this.groupCount!==this.generatedGroupCount){return}this.isGenerated=true;this.xhr={};var k=Object.keys(this.options.source);for(var j=0;j<k.length;j++){this.source[k[j]]=this.tmpSource[k[j]]}this.tmpSource={};this.node.trigger("dynamic"+d)},navigate:function(l){this.helper.executeCallback.call(this,this.options.callback.onNavigateBefore,[this.node,this.query,l]);if(l.keyCode===27){l.preventDefault();if(this.query.length){this.node.val("");this.node.trigger("input"+d)}else{this.node.blur()}return}if(!this.isGenerated||!this.result.length){return}var i=this.resultContainer.find("> ul > li:not([data-search-group])"),m=i.filter(".active"),j=m[0]&&i.index(m)||null,k=null;if(l.keyCode===13){l.preventDefault();if(m.length>0){m.find("a:first")[0].click()}else{this.node.closest("form").submit()}return}if(l.keyCode===39){if(j){i.eq(j).find("a:first")[0].click()}else{if(this.options.hint&&this.hint.container.val()!==""&&this.helper.getCaret(this.node[0])>=this.query.length){i.find('a[data-index="'+this.hintIndex+'"]')[0].click()}}return}if(i.length>0){m.removeClass("active")}if(l.keyCode===38){l.preventDefault();if(m.length>0){if(j-1>=0){k=j-1;i.eq(k).addClass("active")}}else{k=i.length-1;i.last().addClass("active")}}else{if(l.keyCode===40){l.preventDefault();if(m.length>0){if(j+1<i.length){k=j+1;i.eq(k).addClass("active")}}else{k=0;i.first().addClass("active")}}}if(l.preventInputChange&&~[38,40].indexOf(l.keyCode)){this.buildHintLayout(k!==null&&k<this.result.length?[this.result[k]]:null)}if(this.options.hint&&this.hint.container){this.hint.container.css("color",l.preventInputChange?this.hint.css.color:k===null&&this.hint.css.color||this.hint.container.css("background-color")||"fff")}this.node.val(k!==null&&!l.preventInputChange?this.result[k][this.result[k].matchedKey]:this.rawQuery);this.helper.executeCallback.call(this,this.options.callback.onNavigateAfter,[this.node,i,k!==null&&i.eq(k).find("a:first")||undefined,k!==null&&this.result[k]||undefined,this.query,l])},searchResult:function(i){if(!i){this.item={}}this.resetLayout();if(this.helper.executeCallback.call(this,this.options.callback.onSearch,[this.node,this.query])===false){return}if(this.query.length>=this.options.minLength){this.searchResultData()}this.helper.executeCallback.call(this,this.options.callback.onResult,[this.node,this.query,this.result,this.resultCount,this.resultCountPerGroup])},searchResultData:function(){var o=this,w,C=this.options.group&&typeof this.options.group[0]!=="boolean"?this.options.group[0]:"group",p=null,I,v,t,D=this.query.toLowerCase(),A=this.options.maxItemPerGroup,s=this.filters.dynamic&&!this.helper.isEmpty(this.filters.dynamic),G,n={},z,H,u,K,q=typeof this.options.matcher==="function"&&this.options.matcher,m,J,r;if(this.options.accent){D=this.helper.removeAccent.call(this,D)}for(w in this.source){if(!this.source.hasOwnProperty(w)){continue}if(this.filters.dropdown&&this.filters.dropdown.key==="group"&&this.filters.dropdown.value!==w){continue}z=typeof this.options.source[w].filter!=="undefined"?this.options.source[w].filter:this.options.filter;u=typeof this.options.source[w].matcher==="function"&&this.options.source[w].matcher||q;for(var E=0;E<this.source[w].length;E++){if(this.result.length>=this.options.maxItem&&!this.options.callback.onResult){break}if(s&&!this.dynamicFilter.validate.apply(this,[this.source[w][E]])){continue}I=this.source[w][E];p=C==="group"?w:I[C];if(p&&!this.result[p]){this.result[p]=[];this.resultCountPerGroup[p]=0}if(A){if(C==="group"&&this.result[p].length>=A&&!this.options.callback.onResult){break}}G=this.options.source[w].display||this.options.display;for(var F=0;F<G.length;F++){if(typeof z==="function"){H=z.call(this,I,I[G[F]]);if(H===undefined){break}if(!H){continue}if(typeof H==="object"){I=H}}if(~[undefined,true].indexOf(z)){t=I[G[F]];if(!t){if(this.options.debug){n[F]={display:G[F],data:I}}continue}t=t.toString().toLowerCase();if(this.options.accent){t=this.helper.removeAccent.call(this,t)}v=t.indexOf(D);if(this.options.correlativeTemplate&&G[F]==="compiled"&&v<0&&/\s/.test(D)){m=true;J=D.split(" ");r=t;for(var y=0;y<J.length;y++){if(J[y]===""){continue}if(!~r.indexOf(J[y])){m=false;break}r=r.replace(J[y],"")}}if(v<0&&!m){continue}if(this.options.offset&&v!==0){continue}if(this.options.source[w].ignore&&this.options.source[w].ignore.test(t)){continue}if(u){K=u.call(this,I,I[G[F]]);if(K===undefined){break}if(!K){continue}if(typeof K==="object"){I=K}}}if(this.filters.dropdown){if(this.filters.dropdown.value!=I[this.filters.dropdown.key]){continue}}this.resultCount++;this.resultCountPerGroup[p]++;if(this.resultItemCount<this.options.maxItem){if(A&&this.result[p].length>=A){break}I.matchedKey=G[F];this.result[p].push(I);this.resultItemCount++}break}if(!this.options.callback.onResult){if(this.resultItemCount>=this.options.maxItem){break}if(A&&this.result[p].length>=A){if(C==="group"){break}}}}}if(this.options.debug){if(!this.helper.isEmpty(n)){g.log({node:this.node.selector,"function":"searchResult()","arguments":JSON.stringify(n),message:"Missing keys for display, make sure options.display is set properly."});g.print()}}if(this.options.order){var G=[],j;for(var w in this.result){if(!this.result.hasOwnProperty(w)){continue}for(var F=0;F<this.result[w].length;F++){j=this.options.source[this.result[w][F].group].display||this.options.display;if(!~G.indexOf(j[0])){G.push(j[0])}}this.result[w].sort(o.helper.sort(G,o.options.order==="asc",function(i){return i.toString().toUpperCase()}))}}var l=[],B;if(typeof this.options.groupOrder==="function"){B=this.options.groupOrder.apply(this,[this.node,this.query,this.result,this.resultCount,this.resultCountPerGroup])}else{if(this.options.groupOrder instanceof Array){B=this.options.groupOrder}else{if(typeof this.options.groupOrder==="string"&&~["asc","desc"].indexOf(this.options.groupOrder)){B=Object.keys(this.result).sort(o.helper.sort([],o.options.groupOrder==="asc",function(i){return i.toString().toUpperCase()}))}else{B=Object.keys(this.result)}}}for(var F=0;F<B.length;F++){l=l.concat(this.result[B[F]]||[])}this.result=l},buildLayout:function(){this.buildHtmlLayout();this.buildBackdropLayout();this.buildHintLayout();if(this.options.callback.onLayoutBuiltBefore){var i=this.helper.executeCallback.call(this,this.options.callback.onLayoutBuiltBefore,[this.node,this.query,this.result,this.resultHtml]);if(i instanceof jQuery){this.resultHtml=i}else{if(this.options.debug){g.log({node:this.node.selector,"function":"callback.onLayoutBuiltBefore()",message:"Invalid returned value - You must return resultHtmlList jQuery Object"});g.print()}}}this.resultHtml&&this.resultContainer.html(this.resultHtml);if(this.options.callback.onLayoutBuiltAfter){this.helper.executeCallback.call(this,this.options.callback.onLayoutBuiltAfter,[this.node,this.query,this.result])}},buildHtmlLayout:function(){if(this.options.resultContainer===false){return}if(!this.resultContainer){this.resultContainer=f("<div/>",{"class":this.options.selector.result});this.container.append(this.resultContainer)}var i=this.query.toLowerCase();if(this.options.accent){i=this.helper.removeAccent.call(this,i)}var j=this;this.resultHtml=f("<ul/>",{"class":this.options.selector.list+(j.helper.isEmpty(j.result)?" empty":""),html:function(){if(j.options.emptyTemplate&&j.helper.isEmpty(j.result)){var k=typeof j.options.emptyTemplate==="function"?j.options.emptyTemplate.call(j,j.query):j.options.emptyTemplate.replace(/\{\{query}}/gi,j.query.sanitize());if(k instanceof jQuery&&k[0].nodeName==="LI"){return k}else{return f("<li/>",{"class":j.options.selector.empty,html:f("<a/>",{href:"javascript:;",html:k})})}}for(var l in j.result){if(!j.result.hasOwnProperty(l)){continue}(function(s,w,o){var n=w.group,p,q,r=[],u=j.options.source[w.group].display||j.options.display,t=j.options.source[w.group].href||j.options.href,m,v;if(j.options.group){if(j.options.group[1]){if(typeof j.options.group[1]==="function"){n=j.options.group[1](w)}else{if(typeof j.options.group[1]==="string"){n=j.options.group[1].replace(/(\{\{group}})/gi,w[j.options.group[0]]||n)}}}else{if(typeof j.options.group[0]!=="boolean"&&w[j.options.group[0]]){n=w[j.options.group[0]]}}if(!f(o).find('li[data-search-group="'+n+'"]')[0]){f(o).append(f("<li/>",{"class":j.options.selector.group,html:f("<a/>",{href:"javascript:;",html:n}),"data-search-group":n}))}}p=f("<li/>",{"class":j.options.selector.item,html:f("<a/>",{href:function(){if(t){if(typeof t==="string"){t=t.replace(/\{\{([\w\-\.]+)(?:\|(\w+))?}}/g,function(y,x,z){var A=j.helper.namespace(x,w,"get","");if(z&&z==="slugify"){A=j.helper.slugify.call(j,A)}return A})}else{if(typeof t==="function"){t=t(w)}}w.href=t}return t||"javascript:;"},"data-group":n,"data-index":s,html:function(){v=(w.group&&j.options.source[w.group].template)||j.options.template;if(v){if(typeof v==="function"){v=v.call(j,j.query,w)}q=v.replace(/\{\{([\w\-\.]+)(?:\|(\w+))?}}/g,function(z,y,A){var B=String(j.helper.namespace(y,w,"get","")).sanitize();if(!A||A!=="raw"){if(j.options.highlight===true&&i&&~u.indexOf(y)){B=j.helper.highlight.call(j,B,i.split(" "),j.options.accent)}}return B})}else{for(var x=0;x<u.length;x++){r.push(w[u[x]])}q='<span class="'+j.options.selector.display+'">'+String(r.join(" ")).sanitize()+"</span>"}if((j.options.highlight===true&&i&&!v)||j.options.highlight==="any"){q=j.helper.highlight.call(j,q,i.split(" "),j.options.accent)}f(this).append(q)},click:({item:w},function(x){if(j.options.mustSelectItem&&j.helper.isEmpty(w)){x.preventDefault();return}j.item=w;if(j.helper.executeCallback.call(j,j.options.callback.onClickBefore,[j.node,f(this),w,x])===false){return}if((x.originalEvent&&x.originalEvent.defaultPrevented)||x.isDefaultPrevented()){return}j.query=j.rawQuery=w[w.matchedKey].toString();j.node.val(j.query).focus();j.searchResult(true);j.buildLayout();j.hideLayout();j.helper.executeCallback.call(j,j.options.callback.onClickAfter,[j.node,f(this),w,x])}),mouseenter:function(x){f(this).closest("ul").find("li.active").removeClass("active");f(this).closest("li").addClass("active");j.helper.executeCallback.call(j,j.options.callback.onMouseEnter,[j.node,f(this),w,x])},mouseleave:function(x){f(this).closest("li").removeClass("active");j.helper.executeCallback.call(j,j.options.callback.onMouseLeave,[j.node,f(this),w,x])}})});if(j.options.group){m=f(o).find('a[data-group="'+n+'"]:last').closest("li");if(!m[0]){m=f(o).find('li[data-search-group="'+n+'"]')}f(p).insertAfter(m)}else{f(o).append(p)}}(l,j.result[l],this))}}})},buildBackdropLayout:function(){if(!this.options.backdrop){return}if(!this.backdrop.container){this.backdrop.css=f.extend({opacity:0.6,filter:"alpha(opacity=60)",position:"fixed",top:0,right:0,bottom:0,left:0,"z-index":1040,"background-color":"#000"},this.options.backdrop);this.backdrop.container=f("<div/>",{"class":this.options.selector.backdrop,css:this.backdrop.css}).insertAfter(this.container)}this.container.addClass("backdrop").css({"z-index":this.backdrop.css["z-index"]+1,position:"relative"})},buildHintLayout:function(s){if(!this.options.hint){return}if(this.node[0].scrollWidth>Math.ceil(this.node.innerWidth())){this.hint.container&&this.hint.container.val("");return}var r=this,m="",s=s||this.result,o=this.query.toLowerCase();if(this.options.accent){o=this.helper.removeAccent.call(this,o)}this.hintIndex=null;if(this.query.length>=this.options.minLength){if(!this.hint.container){this.hint.css=f.extend({"border-color":"transparent",position:"absolute",top:0,display:"inline","z-index":-1,"float":"none",color:"#727272","box-shadow":"none",cursor:"default","-webkit-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none",height:"50px","padding-left":"43px","font-size":"14px"},this.options.hint);this.hint.container=f("<input/>",{type:this.node.attr("type"),"class":this.node.attr("class"),readonly:true,unselectable:"on",tabindex:-1,click:function(){r.node.focus()}}).addClass(this.options.selector.hint).css(this.hint.css).insertAfter(this.node);this.node.parent().css({position:"relative"})}this.hint.container.css("color",this.hint.css.color);if(o){var q,j,p;for(var n=0;n<s.length;n++){j=s[n].group;q=this.options.source[j].display||this.options.display;for(var l=0;l<q.length;l++){p=String(s[n][q[l]]).toLowerCase();if(this.options.accent){p=this.helper.removeAccent.call(this,p)}if(p.indexOf(o)===0){m=String(s[n][q[l]]);this.hintIndex=n;break}}if(this.hintIndex!==null){break}}}this.hint.container.val(m.length>0&&this.rawQuery+m.substring(this.query.length)||"")}},buildDropdownLayout:function(){if(!this.options.dropdownFilter){return}var m=this,k="all";if(typeof this.options.dropdownFilter==="string"){k=this.options.dropdownFilter}else{if(this.options.dropdownFilter instanceof Array){for(var l=0;l<this.options.dropdownFilter.length;l++){if(this.options.dropdownFilter[l].value==="*"&&this.options.dropdownFilter[l].display){k=this.options.dropdownFilter[l].display;break}}}}f("<span/>",{"class":this.options.selector.filter,html:function(){f(this).append(f("<button/>",{type:"button","class":m.options.selector.filterButton,html:"<span class='"+m.options.selector.filterValue+"'>"+k+"</span> <span class='"+m.options.selector.dropdownCaret+"'></span>",click:function(i){i.stopPropagation();m.container.toggleClass("filter");var n=d+"-dropdown-filter";f("html").off(n);if(m.container.hasClass("filter")){f("html").one("click"+n+" touchstart"+n,function(){m.container.removeClass("filter")})}}}));f(this).append(f("<ul/>",{"class":m.options.selector.dropdown,html:function(){var n=m.options.dropdownFilter;if(~["string","boolean"].indexOf(typeof m.options.dropdownFilter)){n=[];for(var p in m.options.source){if(!m.options.source.hasOwnProperty(p)){continue}n.push({key:"group",value:p})}n.push({key:"group",value:"*",display:typeof m.options.dropdownFilter==="string"&&m.options.dropdownFilter||"All"})}for(var o=0;o<n.length;o++){(function(r,s,q){if((!s.key&&s.value!=="*")||!s.value){if(m.options.debug){g.log({node:m.node.selector,"function":"buildDropdownLayout()","arguments":JSON.stringify(s),message:'WARNING - Missing key or value, skipping dropdown filter."'});g.print()}return}if(s.value==="*"){f(q).append(f("<li/>",{"class":"divider"}))}f(q).append(f("<li/>",{html:f("<a/>",{href:"javascript:;",html:s.display||s.value,click:({item:s},function(i){i.preventDefault();j.apply(m,[s])})})}))}(o,n[o],this))}}}))}}).insertAfter(m.container.find("."+m.options.selector.query));function j(i){if(i.value==="*"){delete this.filters.dropdown}else{this.filters.dropdown=i}this.container.removeClass("filter").find("."+this.options.selector.filterValue).html(i.display||i.value);this.node.trigger("dynamic"+d);this.node.focus()}},dynamicFilter:{isEnabled:false,init:function(){if(!this.options.dynamicFilter){return}this.dynamicFilter.bind.call(this);this.dynamicFilter.isEnabled=true},validate:function(k){var m,i=null,l=null,n;for(var j in this.filters.dynamic){if(!this.filters.dynamic.hasOwnProperty(j)){continue}if(!!~j.indexOf(".")){n=this.helper.namespace(j,k,"get")}else{n=k[j]}if(this.filters.dynamic[j].modifier==="|"&&!i){i=n==this.filters.dynamic[j].value||false}if(this.filters.dynamic[j].modifier==="&"){if(n==this.filters.dynamic[j].value){l=true}else{l=false;break}}}m=i;if(l!==null){m=l;if(l===true&&i!==null){m=i}}return !!m},set:function(i,k){var j=i.match(/^([|&])?(.+)/);if(!k){delete this.filters.dynamic[j[2]]}else{this.filters.dynamic[j[2]]={modifier:j[1]||"|",value:k}}if(this.dynamicFilter.isEnabled){this.searchResult();this.buildLayout()}},bind:function(){var l=this,k;for(var j=0;j<this.options.dynamicFilter.length;j++){k=this.options.dynamicFilter[j];if(typeof k.selector==="string"){k.selector=f(k.selector)}if(!(k.selector instanceof jQuery)||!k.selector[0]||!k.key){if(this.options.debug){g.log({node:this.node.selector,"function":"buildDynamicLayout()",message:'Invalid jQuery selector or jQuery Object for "filter.selector" or missing filter.key'});g.print()}continue}(function(i){i.selector.off(d).on("change"+d,function(){l.dynamicFilter.set.apply(l,[i.key,l.dynamicFilter.getValue(this)])}).trigger("change"+d)}(k))}},getValue:function(i){var j;if(i.tagName==="SELECT"){j=i.value}else{if(i.tagName==="INPUT"){if(i.type==="checkbox"){j=i.checked&&i.getAttribute("value")||i.checked||null}else{if(i.type==="radio"&&i.checked){j=i.value}}}}return j}},showLayout:function(){if(this.container.hasClass("result")){return}if(!this.result.length&&!this.options.emptyTemplate&&!this.options.backdropOnFocus){return}var i=this;f("html").off(d).on("click"+d+" touchstart"+d,function(j){if(f(j.target).closest(i.container)[0]){return}i.hideLayout()});this.container.addClass([this.result.length||(this.options.emptyTemplate&&this.query.length>=this.options.minLength)?"result ":"",this.options.hint&&this.query.length>=this.options.minLength?"hint":"",this.options.backdrop||this.options.backdropOnFocus?"backdrop":""].join(" "));this.helper.executeCallback.call(this,this.options.callback.onShowLayout,[this.node,this.query])},hideLayout:function(){if(!this.container.hasClass("result")&&!this.container.hasClass("backdrop")){return}this.container.removeClass("result hint filter"+(this.options.backdropOnFocus&&f(this.node).is(":focus")?"":" backdrop"));if(this.options.backdropOnFocus&&this.container.hasClass("backdrop")){return}f("html").off(d);this.helper.executeCallback.call(this,this.options.callback.onHideLayout,[this.node,this.query])},resetLayout:function(){this.result={};this.resultCount=0;this.resultCountPerGroup={};this.resultItemCount=0;this.resultHtml=null;if(this.options.hint&&this.hint.container){this.hint.container.val("")}},__construct:function(){this.extendOptions();if(!this.unifySourceFormat()){return}this.dynamicFilter.init.apply(this);this.init();this.delegateEvents();this.buildDropdownLayout();this.helper.executeCallback.call(this,this.options.callback.onReady,[this.node])},helper:{isEmpty:function(i){for(var j in i){if(i.hasOwnProperty(j)){return false}}return true},removeAccent:function(j){if(typeof j!=="string"){return}var i=this.options.accent||c;j=j.toLowerCase().replace(new RegExp("["+i.from+"]","g"),function(k){return i.to[i.from.indexOf(k)]});return j},slugify:function(i){i=String(i);if(i!==""){i=this.helper.removeAccent.call(this,i);i=i.replace(/[^-a-z0-9]+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")}return i},sort:function(k,i,l){var j=function(m){for(var n=0;n<k.length;n++){if(typeof m[k[n]]!=="undefined"){return l(m[k[n]])}}return m};i=[-1,1][+!!i];return function(n,m){return n=j(n),m=j(m),i*((n>m)-(m>n))}},replaceAt:function(i,l,k,j){return i.substring(0,l)+j+i.substring(l+k)},highlight:function(l,n,j){l=String(l);var k=j&&this.helper.removeAccent.call(this,l)||l,o=[];if(!(n instanceof Array)){n=[n]}n.sort(function(p,i){return i.length-p.length});for(var m=n.length-1;m>=0;m--){if(n[m].trim()===""){n.splice(m,1);continue}n[m]=n[m].replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}k.replace(new RegExp("(?:"+n.join("|")+")(?!([^<]+)?>)","gi"),function(p,i,q){o.push({offset:q,length:p.length})});for(var m=o.length-1;m>=0;m--){l=this.helper.replaceAt(l,o[m].offset,o[m].length,"<label>"+l.substr(o[m].offset,o[m].length)+"</label>")}return l},getCaret:function(i){if(i.selectionStart){return i.selectionStart}else{if(document.selection){i.focus();var k=document.selection.createRange();if(k==null){return 0}var j=i.createTextRange(),l=j.duplicate();j.moveToBookmark(k.getBookmark());l.setEndPoint("EndToStart",j);return l.text.length}}return 0},executeCallback:function(k,j){if(!k){return}var i;if(typeof k==="function"){i=k}else{if(typeof k==="string"||k instanceof Array){if(typeof k==="string"){k=[k,[]]}i=this.helper.namespace(k[0],window);if(typeof i!=="function"){if(this.options.debug){g.log({node:this.selector,"function":"executeCallback()","arguments":JSON.stringify(k),message:'WARNING - Invalid callback function"'});g.print()}return}}}return i.apply(this,(k[1]||[]).concat(j?j:[]))},namespace:function(o,r,j,s){if(typeof o!=="string"||o===""){if(this.options.debug){g.log({node:_node.selector,"function":"namespace()","arguments":o,message:'ERROR - Missing namespaceString"'});g.print()}return false}var m=o.split("."),q=r||window,j=j||"get",p=s||{},k="";for(var n=0,l=m.length;n<l;n++){k=m[n];if(typeof q[k]==="undefined"){if(~["get","delete"].indexOf(j)){return typeof s!=="undefined"?s:undefined}q[k]={}}if(~["set","create","delete"].indexOf(j)){if(n===l-1){if(j==="set"||j==="create"){q[k]=p}else{delete q[k];return true}}}q=q[k]}return q},typeWatch:(function(){var i=0;return function(k,j){clearTimeout(i);i=setTimeout(k,j)}})()}};f.fn.typeahead=f.typeahead=function(i){return e.typeahead(this,i)};var e={typeahead:function(j,i){if(!i||!i.source||typeof i.source!=="object"){g.log({node:j.selector||i&&i.input,"function":"$.typeahead()","arguments":JSON.stringify(i&&i.source||""),message:'Undefined "options" or "options.source" or invalid source type - Typeahead dropped'});g.print();return}if(typeof j==="function"){if(!i.input){g.log({node:j.selector,"function":"$.typeahead()",message:'Undefined "options.input" - Typeahead dropped'});g.print();return}j=f(i.input)}if(!j.length||j[0].nodeName!=="INPUT"){g.log({node:j.selector,"function":"$.typeahead()","arguments":JSON.stringify(i.input),message:"Unable to find jQuery input element - Typeahead dropped"});g.print();return}return window.Typeahead[i.input||j.selector]=new h(j,i)}};var g={table:{},log:function(i){if(!i.message||typeof i.message!=="string"){return}this.table[i.message]=f.extend({node:"","function":"","arguments":""},i)},print:function(){if(h.prototype.helper.isEmpty(this.table)||!console||!console.table){return}if(console.group!==undefined||console.table!==undefined){console.groupCollapsed("--- jQuery Typeahead Debug ---");console.table(this.table);console.groupEnd()}this.table={}}};g.log({message:"WARNING - You are using the DEBUG version. Use /dist/jquery.typeahead.min.js in production."});g.print();if(!("sanitize" in String.prototype)){String.prototype.sanitize=function(){var i={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};return this.replace(/[&<>"'\/]/g,function(j){return i[j]})}}window.console=window.console||{log:function(){}};if(!("trim" in String.prototype)){String.prototype.trim=function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")}}if(!("indexOf" in Array.prototype)){Array.prototype.indexOf=function(k,j){if(j===undefined){j=0}if(j<0){j+=this.length}if(j<0){j=0}for(var l=this.length;j<l;j++){if(j in this&&this[j]===k){return j}}return -1}}if(!Object.keys){Object.keys=function(l){var j=[],i;for(i in l){if(Object.prototype.hasOwnProperty.call(l,i)){j.push(i)}}return j}}return h}));